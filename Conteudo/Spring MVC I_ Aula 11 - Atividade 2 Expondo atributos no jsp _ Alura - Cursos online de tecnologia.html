

















<!DOCTYPE html>
<html lang="pt-BR" data-product="alura">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	
	<title>Spring MVC I: Aula 11 - Atividade 2 Expondo atributos no jsp | Alura - Cursos online de tecnologia</title>
	
	
<script type="text/javascript">window.NREUM||(NREUM={}),__nr_require=function(e,n,t){function r(t){if(!n[t]){var o=n[t]={exports:{}};e[t][0].call(o.exports,function(n){var o=e[t][1][n];return r(o||n)},o,o.exports)}return n[t].exports}if("function"==typeof __nr_require)return __nr_require;for(var o=0;o<t.length;o++)r(t[o]);return r}({1:[function(e,n,t){function r(){}function o(e,n,t){return function(){return i(e,[c.now()].concat(u(arguments)),n?null:this,t),n?void 0:this}}var i=e("handle"),a=e(2),u=e(3),f=e("ee").get("tracer"),c=e("loader"),s=NREUM;"undefined"==typeof window.newrelic&&(newrelic=s);var p=["setPageViewName","setCustomAttribute","setErrorHandler","finished","addToTrace","inlineHit","addRelease"],d="api-",l=d+"ixn-";a(p,function(e,n){s[n]=o(d+n,!0,"api")}),s.addPageAction=o(d+"addPageAction",!0),s.setCurrentRouteName=o(d+"routeName",!0),n.exports=newrelic,s.interaction=function(){return(new r).get()};var m=r.prototype={createTracer:function(e,n){var t={},r=this,o="function"==typeof n;return i(l+"tracer",[c.now(),e,t],r),function(){if(f.emit((o?"":"no-")+"fn-start",[c.now(),r,o],t),o)try{return n.apply(this,arguments)}finally{f.emit("fn-end",[c.now()],t)}}}};a("setName,setAttribute,save,ignore,onEnd,getContext,end,get".split(","),function(e,n){m[n]=o(l+n)}),newrelic.noticeError=function(e){"string"==typeof e&&(e=new Error(e)),i("err",[e,c.now()])}},{}],2:[function(e,n,t){function r(e,n){var t=[],r="",i=0;for(r in e)o.call(e,r)&&(t[i]=n(r,e[r]),i+=1);return t}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],3:[function(e,n,t){function r(e,n,t){n||(n=0),"undefined"==typeof t&&(t=e?e.length:0);for(var r=-1,o=t-n||0,i=Array(o<0?0:o);++r<o;)i[r]=e[n+r];return i}n.exports=r},{}],4:[function(e,n,t){n.exports={exists:"undefined"!=typeof window.performance&&window.performance.timing&&"undefined"!=typeof window.performance.timing.navigationStart}},{}],ee:[function(e,n,t){function r(){}function o(e){function n(e){return e&&e instanceof r?e:e?f(e,u,i):i()}function t(t,r,o,i){if(!d.aborted||i){e&&e(t,r,o);for(var a=n(o),u=m(t),f=u.length,c=0;c<f;c++)u[c].apply(a,r);var p=s[y[t]];return p&&p.push([b,t,r,a]),a}}function l(e,n){v[e]=m(e).concat(n)}function m(e){return v[e]||[]}function w(e){return p[e]=p[e]||o(t)}function g(e,n){c(e,function(e,t){n=n||"feature",y[t]=n,n in s||(s[n]=[])})}var v={},y={},b={on:l,emit:t,get:w,listeners:m,context:n,buffer:g,abort:a,aborted:!1};return b}function i(){return new r}function a(){(s.api||s.feature)&&(d.aborted=!0,s=d.backlog={})}var u="nr@context",f=e("gos"),c=e(2),s={},p={},d=n.exports=o();d.backlog=s},{}],gos:[function(e,n,t){function r(e,n,t){if(o.call(e,n))return e[n];var r=t();if(Object.defineProperty&&Object.keys)try{return Object.defineProperty(e,n,{value:r,writable:!0,enumerable:!1}),r}catch(i){}return e[n]=r,r}var o=Object.prototype.hasOwnProperty;n.exports=r},{}],handle:[function(e,n,t){function r(e,n,t,r){o.buffer([e],r),o.emit(e,n,t)}var o=e("ee").get("handle");n.exports=r,r.ee=o},{}],id:[function(e,n,t){function r(e){var n=typeof e;return!e||"object"!==n&&"function"!==n?-1:e===window?0:a(e,i,function(){return o++})}var o=1,i="nr@id",a=e("gos");n.exports=r},{}],loader:[function(e,n,t){function r(){if(!x++){var e=h.info=NREUM.info,n=d.getElementsByTagName("script")[0];if(setTimeout(s.abort,3e4),!(e&&e.licenseKey&&e.applicationID&&n))return s.abort();c(y,function(n,t){e[n]||(e[n]=t)}),f("mark",["onload",a()+h.offset],null,"api");var t=d.createElement("script");t.src="https://"+e.agent,n.parentNode.insertBefore(t,n)}}function o(){"complete"===d.readyState&&i()}function i(){f("mark",["domContent",a()+h.offset],null,"api")}function a(){return E.exists&&performance.now?Math.round(performance.now()):(u=Math.max((new Date).getTime(),u))-h.offset}var u=(new Date).getTime(),f=e("handle"),c=e(2),s=e("ee"),p=window,d=p.document,l="addEventListener",m="attachEvent",w=p.XMLHttpRequest,g=w&&w.prototype;NREUM.o={ST:setTimeout,SI:p.setImmediate,CT:clearTimeout,XHR:w,REQ:p.Request,EV:p.Event,PR:p.Promise,MO:p.MutationObserver};var v=""+location,y={beacon:"bam.nr-data.net",errorBeacon:"bam.nr-data.net",agent:"js-agent.newrelic.com/nr-1044.min.js"},b=w&&g&&g[l]&&!/CriOS/.test(navigator.userAgent),h=n.exports={offset:u,now:a,origin:v,features:{},xhrWrappable:b};e(1),d[l]?(d[l]("DOMContentLoaded",i,!1),p[l]("load",r,!1)):(d[m]("onreadystatechange",o),p[m]("onload",r)),f("mark",["firstbyte",u],null,"api");var x=0,E=e(4)},{}]},{},["loader"]);</script><link rel="shortcut icon" href="/images/alura/favicon.ico">
	
	<link href='//fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Open+Sans:400,300,600,700,800|Source+Serif+Pro' rel='stylesheet'>
	<link rel="preconnect" href="https://fonts.gstatic.com">
	
	<link rel="stylesheet" href="/style/lib/video-js.css">
    <link rel="stylesheet" href="/style/lib/video-js-resolutions.css">
    <link rel="stylesheet" href="/style/lib/prettify.css">

	<link rel="stylesheet" href="/style/gnarus/base.css">
	<link rel="stylesheet" href="/style/gnarus/block/formattedText.css">
	
	<link rel="stylesheet" href="/style/gnarus/page/classPage/container.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/classPage.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/menuSettings.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/alternativeList.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/taskFeedback.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/markdown.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/finishSection.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/phrase.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/hqexplanation.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/openquestion.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/textcontent.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/video.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/singlechoice.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/music.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/multiplechoice.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/videodialog.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/fillintheblank.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/speakingpractice.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/pronunciationpractice.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/repetition.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/genericVideo.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/taskContent.css">
	<link rel="stylesheet" href="/style/gnarus/page/classPage/taskButtons.css">
	<link rel="stylesheet" href="/style/gnarus/block/markdownEditor.css">
	<link rel="stylesheet" href="/style/gnarus/block/audioPlayer.css">

	
	
	<style type="text/css">
		.task:before {
			background-color: #FFE000;
		}
	</style>
	
	
	
	</head>
<body>

<section class='task' data-task-type="hqexplanation" data-task-id="11468" data-author-id="75042" data-course-code="spring-mvc-1-criando-aplicacoes-web" data-section-number="11" data-domain="cursos.alura.com.br" data-hasFeedbackAnswer="false">
	<button title="Abrir/Fechar menu" aria-label="Abrir/Fechar menu" type="button" class='openMenu-button task-body-button '></button>
	
	<section class="task-body">
		<header class="task-body-header">
			<div class="container">
				<h1 class="task-body-header-title">
					<svg class="task-body-header-title-svg" aria-label="Atividade de Explicação">
						<use xlink:href="/images/gnarus/classPage/icon-menu-icons.svg#HQ_EXPLANATION" />
					</svg>
					<small>02</small>
					<span class="task-body-header-title-text"> Expondo atributos no jsp</span>
				</h1>
				<div class="task-body-header-actions">
					<a href="/course/spring-mvc-1-criando-aplicacoes-web/task/11468/next" aria-hidden="true" class="task-actions-button task-actions-button-next task-submit">Próxima Atividade</a>
				</div>
			</div>
		</header>
		<main class="task-body-main" data-should-warn="false">
			





	
		




<section class="hqExplanation" id="task-content">
	<div class="container">
	




<div class="settings">
	<button type="button" class="settings-button" aria-label="Configurações"></button>
	<div class="settings-box">
		<span class="settings-box-title"></span>
		<ul class="settings-box-list">
			
				
				
				
					<li class="settings-box-item settings-box-item-player"><a class="settings-box-item-player--disabled" onclick="event.preventDefault();">Mudar o Player</a></li>
					
						<li class="settings-box-item settings-box-item-suggestion"><a href="/suggestions/new/spring-mvc-1-criando-aplicacoes-web/11468/question">Sugerir Melhoria</a></li>
					
				
			
			
		</ul>
	</div>
</div>
		<div class="formattedText">
			<p>Nas aulas anteriores, fizemos a página de detalhes de produto. Nela, além de exibirmos todos os detalhes do produto, construímos um formulário em que o usuário pode selecionar a opção de preço e clicar no botão de adicionar produto ao carrinho.</p>
<p>Observe que a <code>action</code> deste formulário aponta para uma url diferente. Ela aponta para <code>/carrinho/add</code>. Não temos nenhum código que atenda as requisições enviadas para este endereço. Até o momento só temos classes que atendam as requisições que usam o caminho <code>/produtos</code>.</p>
<p>Veja como está atualmente o formulário de compra de produtos.</p>
<pre class="prettyprint"><code>&lt;form action&#61;&#34;/carrinho/add&#34; method&#61;&#34;post&#34; class&#61;&#34;container&#34;&gt;
    &lt;ul id&#61;&#34;variants&#34; class&#61;&#34;clearfix&#34;&gt;
        &lt;input type&#61;&#34;hidden&#34; name&#61;&#34;produtoId&#34; value&#61;&#34;${produto.id}&#34; /&gt;
        &lt;c:forEach items&#61;&#34;${produto.precos}&#34; var&#61;&#34;preco&#34;&gt;
          &lt;li class&#61;&#34;buy-option&#34;&gt;
            &lt;input type&#61;&#34;radio&#34; name&#61;&#34;tipo&#34; class&#61;&#34;variant-radio&#34; id&#61;&#34;tipo&#34; value&#61;&#34;${preco.tipo}&#34;  checked&#61;&#34;checked&#34;  /&gt;
            &lt;label  class&#61;&#34;variant-label&#34;&gt;
              ${preco.tipo}
            &lt;/label&gt;
            &lt;small class&#61;&#34;compare-at-price&#34;&gt;R$ 39,90&lt;/small&gt;
            &lt;p class&#61;&#34;variant-price&#34;&gt;${preco.valor}&lt;/p&gt;
          &lt;/li&gt;
        &lt;/c:forEach&gt;           
    &lt;/ul&gt;
    &lt;button type&#61;&#34;submit&#34; class&#61;&#34;submit-image icon-basket-alt&#34; alt&#61;&#34;Compre Agora&#34; title&#61;&#34;Compre Agora${produto.titulo}&#34;&gt;&lt;/button&gt;
&lt;/form&gt;</code></pre>
<p>Precisamos criar um novo <strong><em>controller</em></strong>, assim as requisições enviadas para o caminho <code>/carrinho</code> serão atendidas da mesma forma que fizemos com os produtos. Crie então uma nova classe chamada <code>CarrinhoComprasController</code> e não se esqueça de deixa-lo no pacote <code>br.com.casadocodigo.loja.controllers</code>. Faça uso também das anotações <code>&#64;Controller</code> e <code>&#64;RequestMapping</code> com o valor <code>/carrinho</code>, para que o <strong>Spring</strong> reconheça esta classe como um <code>controller</code> e que o mapeamento da rota seja feito corretamente. Até então teremos a classe <code>CarrinhoComprasController</code>:</p>
<pre class="prettyprint"><code>&#64;Controller
&#64;RequestMapping(&#34;/carrinho&#34;)
public class CarrinhoComprasController {

}</code></pre>
<p>A primeira funcionalidade que vamos codificar é a adição de produtos ao carrinho de compras. Vamos começar adicionando um método chamado <code>add</code> na classe <code>CarrinhoComprasController</code> que retorna um objeto do tipo <code>ModelAndView</code>. Este método precisa receber dois parâmetros que são: O id do produto e o tipo de preço selecionado pelo usuário. Lembre-se que apenas o <code>id</code> do produto está sendo enviado pelo formulário da página de detalhes e não o produto.</p>
<p>Ao escolher um produto faremos com que o método redirecione o usuário para a listagem de produtos. Sendo assim, até aqui teremos:</p>
<pre class="prettyprint"><code>&#64;RequestMapping(&#34;/add&#34;)
public ModelAndView add(Integer produtoId, TipoPreco tipo){
    ModelAndView modelAndView &#61; new ModelAndView(&#34;redirect:/produtos&#34;);
    return modelAndView;
}</code></pre>
<p><strong>Observação</strong>: Perceba o uso da anotação <code>&#64;RequestMapping(&#34;/add&#34;)</code> que faz o mapeamento da rota <code>/carrinho/add</code> para este método no <code>CarrinhoComprasController</code>.</p>
<p>Abaixo, vemos a classe <code>CarrinhoComprasController</code> com o código completo escrito até aqui:</p>
<pre class="prettyprint"><code>&#64;Controller
&#64;RequestMapping(&#34;/carrinho&#34;)
public class CarrinhoComprasController {

    &#64;RequestMapping(&#34;/add&#34;)
    public ModelAndView add(Integer produtoId, TipoPreco tipo){
        ModelAndView modelAndView &#61; new ModelAndView(&#34;redirect:/produtos&#34;);

        return modelAndView;
    }

}</code></pre>
<p>O que precisamos fazer agora é definir uma forma de relacionar o produto com seu preço. Podemos fazer isso de uma forma muito simples: criando um outro objeto que represente este relacionamento. O objeto será criado através da classe <code>CarrinhoItem</code> que iremos codificar agora. Esta só terá os atributos <code>produto</code> e <code>tipoPreco</code>. Um construtor que receba estes dois parâmetros e os <strong><em>Getters and Setters</em></strong> destes mesmos atributos. Assim teremos a classe <code>CarrinhoItem</code>:</p>
<pre class="prettyprint"><code>public class CarrinhoItem {

    private TipoPreco tipoPreco;
    private Produto produto;

    public CarrinhoItem(Produto produto, TipoPreco tipoPreco) {
        this.produto &#61; produto;
        this.tipoPreco &#61; tipoPreco;
    }

    public TipoPreco getTipoPreco() {
        return tipoPreco;
    }

    public void setTipoPreco(TipoPreco tipoPreco) {
        this.tipoPreco &#61; tipoPreco;
    }

    public Produto getProduto() {
        return produto;
    }

    public void setProduto(Produto produto) {
        this.produto &#61; produto;
    }
}</code></pre>
<p><strong>Observação</strong>: Por se tratar de uma classe de negócio, esta ficará no pacote <code>br.com.casadocodigo.loja.models</code>. Ela não é um <code>controller</code> nem uma <code>view</code> e contém uma lógica importante para o negócio.</p>
<p>Nosso próximo passo será criar um método privado na classe <code>CarrinhoComprasController</code> para que ele crie e retorne um objeto da classe <code>CarrinhoItem</code>. Busque o produto pelo <code>id</code> no banco de dados e relacione o produto com o preço selecionado pelo usuário. Chamaremos este método de <code>criaItem</code>. Como estamos falando de buscar produtos no banco de dados, criaremos também um atributo na classe <code>CarrinhoComprasController</code> do tipo <code>ProdutoDAO</code> chamado <code>produtoDao</code>, com a anotação <code>&#64;Autowired</code>. Iremos usá-lo para a busca do produto.</p>
<pre class="prettyprint"><code>&#64;Autowired
private ProdutoDAO produtoDao;

private CarrinhoItem criaItem(Integer produtoId, TipoPreco tipo){
    Produto produto &#61; produtoDao.find(produtoId);
    CarrinhoItem carrinhoItem &#61; new CarrinhoItem(produto, tipo);
    return carrinhoItem;
}</code></pre>
<p>Agora temos que usar o método dentro do método <code>add</code> da classe <code>CarrinhoComprasController</code>, passando para ele o <code>produtoId</code> e o <code>tipo</code> de preço. Então receberemos o objeto retornado pelo método <code>criaItem</code>.</p>
<pre class="prettyprint"><code>CarrinhoItem carrinhoItem &#61; criaItem(produtoId, tipo);</code></pre>
<p>O médoto <code>add</code> até o momento ficará assim:</p>
<pre class="prettyprint"><code>&#64;RequestMapping(&#34;/add&#34;)
public ModelAndView add(Integer produtoId, TipoPreco tipo){
    ModelAndView modelAndView &#61; new ModelAndView(&#34;redirect:/produtos&#34;);
    CarrinhoItem carrinhoItem &#61; criaItem(produtoId, tipo);
    return modelAndView;
}</code></pre>
<p>O que fica faltando para terminarmos a funcionalidade de adicionar produtos ao carrinho de compras é: O próprio carrinho, incluindo pelo menos um método que faça a adição do <code>carrinhoItem</code> a uma lista. Vamos fazer isso, então.</p>
<p>Crie uma nova classe chamada <code>CarrinhoCompras</code> no pacote br.com.casadocodigo.loja.models e logo em seguida crie um método que não tem retorno, ou seja, <code>void</code> chamado <code>add</code>. Este método deve receber um objeto da classe <code>CarrinhoItem</code> que é a classe que representa um item em nosso carrinho.</p>
<pre class="prettyprint"><code>public class CarrinhoCompras {
    public void add(CarrinhoItem item){

    }
}</code></pre>
<p>Algo comum nas lojas online é que ao selecionarmos determinado produto, podemos também especificar a quantidade. Nossa página de detalhes não permite esse tipo de comportamento, mas em no carrinho de compras fará muito sentido incluir este tipo de informação. Por isso precisaremos de uma lista que associe o item a sua quantidade. Neste caso, usaremos uma do tipo <code>Map</code>, que permitirá a associação entre uma chave, que será o item do carrinho, e um valor, que será a quantidade total de cópias do mesmo produto.</p>
<p>Logo, adicionaremos à classe <code>carrinho</code> um atributo privado chamado <code>itens</code>, do tipo <code>Map&lt;CarrinhoItem, Integer&gt;</code>, e o instanciaremos com um objeto da classe <code>LinkedHashMap</code>.</p>
<pre class="prettyprint"><code>private Map&lt;CarrinhoItem, Integer&gt; itens &#61; new LinkedHashMap&lt;CarrinhoItem, Integer&gt;();</code></pre>
<p>Com a lista pronta, precisaremos que ao adicionarmos um produto, seja verificado se o produto já existe em nossa lista. Caso exista, somaremos <code>&#43;1</code> na quantidade, caso não exista, adicionamos o produto selecionado. Veja o código abaixo:</p>
<pre class="prettyprint"><code>public void add(CarrinhoItem item){
    itens.put(item, getQuantidade(item) &#43; 1);
}</code></pre>
<p>Apesar de não termos o método <code>getQuantidade</code> ainda, pode-se notar que a lógica é simples. Ele deve retornar o número de vezes em que o produto foi encontrado na lista e somar <code>1</code> a essa quantidade. Agora vejamos como fica essa lógica em código.</p>
<pre class="prettyprint"><code>private int getQuantidade(CarrinhoItem item) {
    if(!itens.containsKey(item)){
        itens.put(item, 0);
    }
    return itens.get(item);
}</code></pre>
<p>Perceba que estamos usando o método <code>containsKey</code> que verifica se a lista tem a chave, que no caso é o item do carrinho. Estamos usando <code>!</code> que é o sinal de negação da expressão lógica. Ou seja, se a lista não tiver o item, este será adicionado com o valor <code>0</code> na mesma. E então o método <code>get</code> usado no <code>return</code> retorna o valor que está associado aquela chave.</p>
<p>Explicando melhor... Caso o item não exista na lista, colocamos o item e retornamos o valor 0, que será incrementado pelo metódo <code>add</code>. Mas caso o item já exista, retornamos apenas o valor que representa a quantidade de vezes que o produto foi adicionado na lista.</p>
<p>Apesar de usar o método <code>containsKey</code> não é o suficiente. Ele usa o método <code>equals</code> disponível na classe <code>Object</code>. Para que o método <code>containsKey</code> consiga comparar corretamente os itens da lista, devemos sobrescrever dois métodos na classe <code>CarrinhoItem</code> e depois, na classe <code>Produto</code>. Use os geradores do Eclipse e selecione a opção <strong><em>Generate HashCode and Equals</em></strong>. Na classe <code>CarrinhoItem</code>, teremos algo parecido com:</p>
<pre class="prettyprint"><code>&#64;Override
public int hashCode() {
    final int prime &#61; 31;
    int result &#61; 1;
    result &#61; prime * result &#43; ((produto &#61;&#61; null) ? 0 : produto.hashCode());
    result &#61; prime * result &#43; ((tipoPreco &#61;&#61; null) ? 0 : tipoPreco.hashCode());
    return result;
}

&#64;Override
public boolean equals(Object obj) {
    if (this &#61;&#61; obj)
        return true;
    if (obj &#61;&#61; null)
        return false;
    if (getClass() !&#61; obj.getClass())
        return false;
    CarrinhoItem other &#61; (CarrinhoItem) obj;
    if (produto &#61;&#61; null) {
        if (other.produto !&#61; null)
            return false;
    } else if (!produto.equals(other.produto))
        return false;
    if (tipoPreco !&#61; other.tipoPreco)
        return false;
    return true;
}</code></pre>
<p><strong>Observação</strong>: Lembre-se que estes métodos são gerados a partir dos atributos da classe. No caso da classe <code>CarrinhoItem</code>, deixamos todos os atributos selecionados, mas no caso da classe <code>Produto</code>, usaremos apenas o atributo <code>id</code> que é gerado pelo banco de dados e nos garante que o produto é único. Na classe produto, teremos:</p>
<pre class="prettyprint"><code>&#64;Override
public int hashCode() {
    final int prime &#61; 31;
    int result &#61; 1;
    result &#61; prime * result &#43; id;
    return result;
}

&#64;Override
public boolean equals(Object obj) {
    if (this &#61;&#61; obj)
        return true;
    if (obj &#61;&#61; null)
        return false;
    if (getClass() !&#61; obj.getClass())
        return false;
    Produto other &#61; (Produto) obj;
    if (id !&#61; other.id)
        return false;
    return true;
}</code></pre>
<p>Com tudo isso feito, estamos quase prontos para testar se o carrinho de compras da nossa aplicação está realmente funcionando. O último passo é usar a anotação <code>&#64;Component</code> na classe <code>CarrinhoCompras</code> para que o <strong>Spring</strong> instancie automaticamente objetos desta classe quando necessário. Depois, a classe ficará desta forma:</p>
<pre class="prettyprint"><code>&#64;Component
public class CarrinhoCompras {
    private Map&lt;CarrinhoItem, Integer&gt; itens &#61; new LinkedHashMap&lt;CarrinhoItem, Integer&gt;();

    public void add(CarrinhoItem item){
        itens.put(item, getQuantidade(item) &#43; 1);
    }

    private int getQuantidade(CarrinhoItem item) {
        if(!itens.containsKey(item)){
            itens.put(item, 0);
        }
        return itens.get(item);
    }

}</code></pre>
<p>Lembre-se de que ainda não estamos adicionando os produtos ao carrinho de compras. Precisamos fazer isso no método <code>add</code> da classe <code>CarrinhoComprasController</code>. Primeiro faremos com que o <strong>Spring</strong> instancie para nós o carrinho de compras. Fazemos isso criando um atributo no <strong><em>controller</em></strong> em questão, que chamaremos de <code>carrinho</code> e o anotaremos com <code>&#64;Autowired</code>.</p>
<pre class="prettyprint"><code>&#64;Controller
&#64;RequestMapping(&#34;/carrinho&#34;)
public class CarrinhoComprasController {

    &#64;Autowired
    private CarrinhoCompras carrinho;
}</code></pre>
<p>Após isso, no método <code>add</code> da classe <code>CarrinhoComprasController</code>, usaremos o método <code>add</code> do objeto <code>carrinho</code>, passando o objeto <code>carrinhoItem</code> para que este seja adicionado ao carrinho de compras.</p>
<p>Até aqui o método <code>add</code> da classe <code>CarrinhoComprasController</code> está assim:</p>
<pre class="prettyprint"><code>&#64;RequestMapping(&#34;/add&#34;)
public ModelAndView add(Integer produtoId, TipoPreco tipo){
    ModelAndView modelAndView &#61; new ModelAndView(&#34;redirect:/produtos&#34;);
    CarrinhoItem carrinhoItem &#61; criaItem(produtoId, tipo);
    return modelAndView;
}</code></pre>
<p>Em seguida, ficará assim:</p>
<pre class="prettyprint"><code>&#64;RequestMapping(&#34;/add&#34;)
public ModelAndView add(Integer produtoId, TipoPreco tipo){
    ModelAndView modelAndView &#61; new ModelAndView(&#34;redirect:/produtos&#34;);
    CarrinhoItem carrinhoItem &#61; criaItem(produtoId, tipo);
    carrinho.add(carrinhoItem);
    return modelAndView;
}</code></pre>
<p>Podemos iniciar agora o servidor <code>Tomcat</code> para podermos testar essa nova funcionalidade. Mas ao iniciar, recebemos uma mensagem de erro:</p>
<pre class="prettyprint"><code>No qualifying bean of type [br.com.casadocodigo.loja.models.CarrinhoCompras] found for dependency: expected at least 1 bean which qualifies as autowire candidate for this dependency</code></pre>
<p>Já vimos este erro antes. O <strong>Spring</strong> não está conseguindo encontrar a classe <code>CarrinhoCompras</code>. Isto porque o pacote <code>models</code> não está sendo scaneado pelo <strong>Spring</strong>. Da mesma forma que fizemos com o <code>ProdutoDAO</code> outra vez, faremos agora com o <code>CarrinhoCompras</code>. Na anotação <code>&#64;ComponentScan</code> da classe <code>AppWebConfiguration</code> adicionaremos a classe <code>CarrinhoCompras</code>.</p>
<pre class="prettyprint"><code>&#64;EnableWebMvc
&#64;ComponentScan(basePackageClasses&#61;{HomeController.class, ProdutoDAO.class, FileSaver.class, CarrinhoCompras.class})
public class AppWebConfiguration {
    [...]
}</code></pre>
<p>Se tentarmos testar novamente agora, não iremos receber nenhum erro do servidor. Então, tente acessar a listagem de produtos, escolher um tipo de preço e clicar no botão de adicionar produto ao carrinho. Teremos um novo erro.</p>
<p><img src="https://s3.amazonaws.com/caelum-online-public/SpringMVC&#43;-&#43;criando&#43;webapp/springmvc_i_webaapp_11_404_carrinho_add.png" alt="404 - Not Found para /carrinho/add" /></p>
<p>Note a URL da página, ela não tem o contexto da aplicação. O contexto seria o <code>/casadocodigo</code> que é o nome do projeto. A URL da página fica com o endereço <code>localhost:8080/carrinho/add</code>. Para corrigir isso, usaremos uma tag da <code>taglib</code> core da <code>JSTL</code> no formulário da página de detalhes do produto.</p>
<p>No Arquivo <code>detalhes.jsp</code> na tag <code>form</code>, teremos o atribudo <code>action</code> com o valor <code>/carrinho/add</code>. Este tipo de endereço, faz com que o contexto da aplicação seja perdido. A tag <code>c:url</code> da <code>JSTL</code> cria URLs baseadas no contexto. Ela resolverá nosso problema. Antes das alterações, a <code>action</code> do formulário em <code>detalhes.jsp</code> está assim:</p>
<pre class="prettyprint"><code>[...]
    &lt;form action&#61;&#34;/carrinho/add&#34; method&#61;&#34;post&#34; class&#61;&#34;container&#34;&gt;
[...]</code></pre>
<p>Agora, ela ficará assim:</p>
<pre class="prettyprint"><code>[...]
    &lt;form action&#61;&#39;&lt;c:url value&#61;&#34;/carrinho/add&#34; /&gt;&#39; method&#61;&#34;post&#34; class&#61;&#34;container&#34;&gt;
[...]</code></pre>
<p><strong>Observação</strong>: Fique atento sobre as <strong>aspas</strong> nesta modificação, foi necessária a mudança por causa de conflitos que seriam gerados se usássemos aspas iguais no atribudo <code>action</code> e na tag <code>c:url</code>. Agora, estará tudo funcionando normalmente.</p>
<p>Da página de detalhes somos levados à listagem dos produtos quando selecionados o tipo de preço do produto e clicamos na opção de adicionar o produto ao carrinho. Mas nada indica que o produto foi realmente adicionado. Vamos fazer com que o número de produtos no carrinho seja exibido junto ao link carrinho encontrado na página de detalhes. No seguinte trecho de código:</p>
<pre class="prettyprint"><code>&lt;li&gt;&lt;a href&#61;&#34;/cart&#34; rel&#61;&#34;nofollow&#34;&gt;Carrinho&lt;/a&gt;&lt;/li&gt;</code></pre>
<p>Faremos algo do tipo:</p>
<pre class="prettyprint"><code>&lt;li&gt;&lt;a href&#61;&#34;/cart&#34; rel&#61;&#34;nofollow&#34;&gt;Carrinho (${carrinhoCompras.quantidade}) &lt;/a&gt;&lt;/li&gt;</code></pre>
<p>A classe <code>CarrinhoCompras</code> já tem um método <code>getQuantidade</code>, mas ele só retorna a quantidade de um produto especifico. Criaremos um novo método <code>getQuantidade</code> que irá iterar entre todos os itens do carrinho e contar quantos produtos estão na lista de itens. Observe o seguinte código:</p>
<pre class="prettyprint"><code>public int getQuantidade(){
    return itens.values().stream().reduce(0, (proximo, acumulador) -&gt; (proximo &#43; acumulador));
}</code></pre>
<p>Este código percorre toda a lista de itens e soma o valor de cada item a um aculumador. Caso não conheça a API de Stream e Lambdas, que são recursos do Java 8, recomendamos que faça o <a href="https://www.alura.com.br/curso-online-java8-lambdas" rel="nofollow">curso de java 8</a> disponível aqui no Alura.</p>
<p>Veja o link de menu como se encontra após estas modificações:  </p>
<p><img src="https://s3.amazonaws.com/caelum-online-public/SpringMVC&#43;-&#43;criando&#43;webapp/springmvc_i_webaapp_11_carrinho_sem_total.png" alt="Link do carrinho sem mostrar o total" /></p>
<p>Apesar de parecer funcionar, não funciona. Ao testarmos adicionar alguns produtos no carrinho, veremos que não há um número indicando que a contagem dos itens está sendo feita corretamente. Isto acontece porque o objeto que representa o carrinho de compras não está disponível em lugar nenhum a não ser dentro do escopo do <strong>Spring</strong>.</p>
<p>Anteriormente, marcamos a classe <code>CarrinhoCompras</code> com a anotação <code>&#64;Component</code>. Essa anotação indica que a classe será tratada como um <strong><em>Bean</em></strong> do <strong>Spring</strong>. Para que possamos acessar esse <strong><em>Bean</em></strong> em nossas <code>view</code>, precisaremos adicionar uma configuração na classe <code>WebAppConfiguration</code>. No método <code>InternalResourceViewResolver</code> poderiamos usar o método <code>setExposeContextBeansAsAttributes</code> do objeto <code>resolver</code> com o valor <code>true</code>, mas esta configuração tornará todos os <strong><em>Beans</em></strong> da aplicação disponíveis, o que parece não ser uma boa ideia.</p>
<p>Ao invés disso, usaremos o método <code>setExposedContextBeanNames</code> deste mesmo objeto. Este método nos permite dizer qual <strong>*Bean</strong> estará disponível para a <code>view</code>. Os nomes dos <strong><em>Beans</em></strong> seguem um padrão bem simples. O padrão é o nome da classe com sua primeira em minúsculo, ou seja, a classe <code>CarrinhoCompras</code> fica <code>carrinhoCompras</code>. Com esta mudança o método <code>InternalResourceViewResolver</code> da classe <code>WebAppConfiguration</code> fica assim:</p>
<pre class="prettyprint"><code>&#64;Bean
public InternalResourceViewResolver internalResourceViewResolver(){
    InternalResourceViewResolver resolver &#61; new InternalResourceViewResolver();
    resolver.setPrefix(&#34;/WEB-INF/views/&#34;);
    resolver.setSuffix(&#34;.jsp&#34;);
    resolver.setExposedContextBeanNames(&#34;carrinhoCompras&#34;);
    return resolver;
}</code></pre>
<p>Teste novamente, verá que agora a contagem acontece normalmente e é exibida na parte superior da página de detalhes da seguinte forma:   </p>
<p><img src="https://s3.amazonaws.com/caelum-online-public/SpringMVC&#43;-&#43;criando&#43;webapp/springmvc_i_webaapp_11_carrinho_com_total.png" alt="Carrinho exibindo total" /></p>
<p>Até aqui, fizemos uma séria de adições em nossa aplicação. Criamos o carrinho de compras, relacionamos os produtos e seus tipos de preço atravé de um item de carrinho e exibimos a contagem de itens no carrinho em nossa <code>view</code>.  </p>
<p>Caso tenha dúvidas, fique a vontade para perguntar no forúm. Agora vamos praticar um pouco mais com alguns exercícios.  </p>

		</div>
	</div>
</section>
	
	
	
	
	
	
	
	
	
	
	
	

			
				



<section class="task-actions">
	<div class="container">
		





<a href="/forum/curso-spring-mvc-1-criando-aplicacoes-web/exercicio-expondo-atributos-no-jsp/11468/novo" class=" task-actions-button task-actions-button-forum" data-amplitude-onsubmit='{"name":"help-needed","course-code":"spring-mvc-1-criando-aplicacoes-web","task-id":"11468","task-kind":"Explicação"}'>Tirar Dúvida</a><!--
		 --><a href="/course/spring-mvc-1-criando-aplicacoes-web/task/11468/next" class="task-actions-button task-body-actions-button task-actions-button-next">Próxima Atividade</a>
	</div>
</section>
			
		</main>
	</section>
	











<aside class="task-menu">
	<section class="task-menu-header">
		<button title="Abrir/Fechar menu" aria-label="Abrir/Fechar menu" type="button" class='openMenu-button task-menu-button '></button>
		<div class="task-menu-header-info">
			<a class="task-menu-header-info-title" href="/course/spring-mvc-1-criando-aplicacoes-web" title="Ir para página do curso">
				<img src="https://www.alura.com.br/assets/api/cursos/spring-mvc-1-criando-aplicacoes-web.svg" alt="ícone Spring MVC I: Criando aplicações web" class="task-menu-header-info-title-icon " width="37.5px" height="37.5px"/>
				<h2 class="task-menu-header-info-title-text">Spring MVC I: Criando aplicações web</h2>
			</a>
			<div class="task-menu-header-info-progress">
				
				<span class="task-menu-header-info-progress-percentage ">57%</span>
				<span class="task-menu-header-info-progress-bar" style="background-image: linear-gradient(to right, #9de482, #9de482 57%, transparent 57%);"></span>
			</div>
		</div>
	</section>
	
	<section class="task-menu-section">
		<div class="task-menu-section-title">
			<span class="task-menu-section-title-number ">Aula<strong>11</strong>
				<span>de 14</span></span>
			<h3 class="task-menu-section-title-text">
				Expondo atributos no jsp
			</h3>
		</div>
	</section>
	<nav class="task-menu-nav">
		<h2 class="task-menu-nav-title">
			Atividades
			<span>2 de 8</span>
		</h2>
		<ul class="task-menu-nav-list">
			
				<li class="task-menu-nav-item ">
					<a href="/course/spring-mvc-1-criando-aplicacoes-web/task/11467" class="task-menu-nav-item-link task-menu-nav-item-link-VIDEO">
					<svg class="task-menu-nav-item-svg task-menu-nav-item-svg--done" aria-label="Atividade de Vídeo concluída">
						<use xlink:href="/images/gnarus/classPage/icon-menu-icons.svg#VIDEO" />
					</svg>
					<span class="task-menu-nav-item-number">01</span>
					<span class="task-menu-nav-item-text" >
						<span class="task-menu-nav-item-title" title="Vídeo 1">
							Vídeo 1
						</span>
						
						<span class="task-menu-nav-item-infos">
							
								<span class="task-menu-nav-item-videoDuration" title="Ir para o Vídeo">29min</span>
							
						</span>
					</span>
					
					</a>
				</li>
			
				<li class="task-menu-nav-item task-menu-nav-item--selected">
					<a href="/course/spring-mvc-1-criando-aplicacoes-web/task/11468" class="task-menu-nav-item-link task-menu-nav-item-link-HQ_EXPLANATION">
					<svg class="task-menu-nav-item-svg task-menu-nav-item-svg--done" aria-label="Atividade de Explicação concluída">
						<use xlink:href="/images/gnarus/classPage/icon-menu-icons.svg#HQ_EXPLANATION" />
					</svg>
					<span class="task-menu-nav-item-number">02</span>
					<span class="task-menu-nav-item-text" >
						<span class="task-menu-nav-item-title" title="Expondo atributos no jsp">
							Expondo atributos no jsp
						</span>
						
					</a>
				</li>
			
				<li class="task-menu-nav-item ">
					<a href="/course/spring-mvc-1-criando-aplicacoes-web/task/11469" class="task-menu-nav-item-link task-menu-nav-item-link-OPEN_QUESTION">
					<svg class="task-menu-nav-item-svg " aria-label="Atividade de Exercício Aberto não concluída">
						<use xlink:href="/images/gnarus/classPage/icon-menu-icons.svg#OPEN_QUESTION" />
					</svg>
					<span class="task-menu-nav-item-number">03</span>
					<span class="task-menu-nav-item-text" >
						<span class="task-menu-nav-item-title" title="Formatando datas">
							Formatando datas
						</span>
						
					</a>
				</li>
			
				<li class="task-menu-nav-item ">
					<a href="/course/spring-mvc-1-criando-aplicacoes-web/task/11470" class="task-menu-nav-item-link task-menu-nav-item-link-OPEN_QUESTION">
					<svg class="task-menu-nav-item-svg " aria-label="Atividade de Exercício Aberto não concluída">
						<use xlink:href="/images/gnarus/classPage/icon-menu-icons.svg#OPEN_QUESTION" />
					</svg>
					<span class="task-menu-nav-item-number">04</span>
					<span class="task-menu-nav-item-text" >
						<span class="task-menu-nav-item-title" title="Criando os itens para o carrinho de compras">
							Criando os itens para o carrinho de compras
						</span>
						
					</a>
				</li>
			
				<li class="task-menu-nav-item ">
					<a href="/course/spring-mvc-1-criando-aplicacoes-web/task/11471" class="task-menu-nav-item-link task-menu-nav-item-link-OPEN_QUESTION">
					<svg class="task-menu-nav-item-svg " aria-label="Atividade de Exercício Aberto não concluída">
						<use xlink:href="/images/gnarus/classPage/icon-menu-icons.svg#OPEN_QUESTION" />
					</svg>
					<span class="task-menu-nav-item-number">05</span>
					<span class="task-menu-nav-item-text" >
						<span class="task-menu-nav-item-title" title="Criando a classe que representa o carrinho">
							Criando a classe que representa o carrinho
						</span>
						
					</a>
				</li>
			
				<li class="task-menu-nav-item ">
					<a href="/course/spring-mvc-1-criando-aplicacoes-web/task/11472" class="task-menu-nav-item-link task-menu-nav-item-link-OPEN_QUESTION">
					<svg class="task-menu-nav-item-svg " aria-label="Atividade de Exercício Aberto não concluída">
						<use xlink:href="/images/gnarus/classPage/icon-menu-icons.svg#OPEN_QUESTION" />
					</svg>
					<span class="task-menu-nav-item-number">06</span>
					<span class="task-menu-nav-item-text" >
						<span class="task-menu-nav-item-title" title="Acessando o carrinho">
							Acessando o carrinho
						</span>
						
					</a>
				</li>
			
				<li class="task-menu-nav-item ">
					<a href="/course/spring-mvc-1-criando-aplicacoes-web/task/11473" class="task-menu-nav-item-link task-menu-nav-item-link-OPEN_QUESTION">
					<svg class="task-menu-nav-item-svg " aria-label="Atividade de Exercício Aberto não concluída">
						<use xlink:href="/images/gnarus/classPage/icon-menu-icons.svg#OPEN_QUESTION" />
					</svg>
					<span class="task-menu-nav-item-number">07</span>
					<span class="task-menu-nav-item-text" >
						<span class="task-menu-nav-item-title" title="Adicionando a quantidade no menu">
							Adicionando a quantidade no menu
						</span>
						
					</a>
				</li>
			
				<li class="task-menu-nav-item ">
					<a href="/course/spring-mvc-1-criando-aplicacoes-web/task/11474" class="task-menu-nav-item-link task-menu-nav-item-link-OPEN_QUESTION">
					<svg class="task-menu-nav-item-svg " aria-label="Atividade de Exercício Aberto não concluída">
						<use xlink:href="/images/gnarus/classPage/icon-menu-icons.svg#OPEN_QUESTION" />
					</svg>
					<span class="task-menu-nav-item-number">08</span>
					<span class="task-menu-nav-item-text" >
						<span class="task-menu-nav-item-title" title="Disponibilizando o carrinho para as views">
							Disponibilizando o carrinho para as views
						</span>
						
					</a>
				</li>
			
		</ul>
	</nav>
	<section class="task-menu-sections">
		<h2 class="task-menu-sections-title">
			Aulas
		</h2>
		<select class="task-menu-sections-select" onchange="location.href='/course/spring-mvc-1-criando-aplicacoes-web/section/'+this.value;">
			
				<option value="1" >01. Começando com SpringMVC</option>
			
				<option value="2" >02. Cadastro de produtos</option>
			
				<option value="3" >03. Cadastro de preços do produto</option>
			
				<option value="4" >04. Listando os produtos</option>
			
				<option value="5" >05. Redirect com Escopo de Flash</option>
			
				<option value="6" >06. Validação e conversão de dados</option>
			
				<option value="7" >07. Mais Validações </option>
			
				<option value="8" >08. Formatação de datas</option>
			
				<option value="9" >09. Enviando arquivos ao servidor</option>
			
				<option value="10" >10. Url amigáveis</option>
			
				<option value="11" selected>11. Expondo atributos no jsp</option>
			
				<option value="12" >12. Escopo sessão</option>
			
				<option value="13" >13. Carrinho de compras</option>
			
				<option value="14" >14. Finalizando o carrinho</option>
			
		</select>
	</section>
	<section class="task-menu-others">
		<h2 class="task-menu-others-title ">
			Outros Links
		</h2>
		<a href="/forum/curso-spring-mvc-1-criando-aplicacoes-web/todos" class="task-menu-others-link task-menu-others-link-forum " title="Ir para o fórum do curso">Fórum</a>
		<a href="/dashboard" class="task-menu-others-link task-menu-others-link-curso" title="Ir para a página principal">Trocar Curso</a>
	</section>
	<section class="task-menu-footer">
		<a class="task-menu-footer-user" href="/user/altair-lage" title="Ir para sua página de usuário">
			<img src="https://www.gravatar.com/avatar/846d7bad034e3c292bc8e433e11b4683.png?r=PG&size=60x60&d=https%3A%2F%2Fcursos.alura.com.br%2Fimages%2Fforum%2Favatar_a.png" alt="Gravatar de Altair Lage" class="task-menu-footer-img" width="40px" height="40px"/>
			
				<p class="task-menu-footer-detalhes">
					<span class="task-menu-footer-detalhes-nome">Altair Lage</span>
					<span class="task-menu-footer-detalhes-xp">
						28.8k xp
					</span>
				</p>
			
			<input type="hidden" value="" />
			<input type="hidden" value="" />
		</a>
		<a href="/dashboard" class="task-menu-footer-logo">
			<img src="/images/gnarus/classPage/icon-menu-alura.svg" alt="Logo da Alura" class="task-menu-footer-logo-image" width="19px" height="32px" title="Ir para a página principal" />
		</a>
	</section>
</aside>
</section>




	<script src="/script/lib/jquery2/jquery-2.1.3.min.js"></script>
	<script src="/script/gnarus/block/buttonToggle.js" async></script>
	<script src="/script/gnarus/block/sectionMenu.js" async></script>

	<script src="/script/lib/marked.js"></script>
	<script src="/script/gnarus/block/markdownEditor.js" async></script>
	<script src="/script/gnarus/block/caret.js" async></script>
	<script src="/js/gnarus/keydownWatchers.js" async></script>
	<script src="/js/prettify.js" async></script>

	<script src="/script/gnarus/block/preventsDoubleClick.js" async></script>
	<script src="/script/gnarus/block/assessment.js" async></script>
	<script src="/script/gnarus/block/login-form.js" async></script>
	<script src="/script/gnarus/classPage/classPage.js"></script>
	<script src="/script/gnarus/classPage/aria.js"></script>
	<script src="/script/gnarus/classPage/phrase.js"></script>
	<script src="/script/gnarus/classPage/feedback.js"></script>
	
	

	
	
	
	

	<script src="/script/musicdot/partitura.js"></script>
	<script src="/script/gnarus/classPage/audioProgress.js"></script>

	
	
	
		

<script type="text/javascript" src="/js/amplitude.js"></script>

<script>

	amplitudeInit("84647047775d06b4051d80eccd387bd3");
	
	
		var userProperties = {"name":"Altair Lage","email":"altair.lage@datablink.com"};
		amplitudeIdentify("75042", userProperties);
	
	
	

	
	
	$('[data-amplitude]').on('click', function(){
		var data = $(this).data().amplitude;
		track(data);
	});
	
</script>

		
		
			<script>
				track({"name":"task-seen","course-code":"spring-mvc-1-criando-aplicacoes-web","task-id":"11468","task-kind":"Explicação"});
			</script>
		
	
	
 

<script type="text/javascript">window.NREUM||(NREUM={});NREUM.info={"errorBeacon":"bam.nr-data.net","licenseKey":"b5f9030682","agent":"","beacon":"bam.nr-data.net","applicationTime":51,"applicationID":"12544460","transactionName":"ZVFTNhEEXEdTWkdeV1wbchcQEV1ZHVtBGVtdWR8BAgBeQV8XVFlZQEFCTAsEQFhXQEJCUVxaHwEMC0ZGXVVfUkocZ1QBFwxdWnFWXUNKXVhdBxFKQVxdTmdWS1k=","queueTime":0}</script></body>
</html>
